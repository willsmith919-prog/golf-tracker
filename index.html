<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>LiveLinks - Real-time Golf Scoring</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  
  <style>
    body { margin: 0; padding: 0; overflow-x: hidden; }
    input, textarea { font-size: 16px !important; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyB8u4N8yPT9VJejYCgfT_v_FSGohCghr1M",
      authDomain: "livelinks-cf018.firebaseapp.com",
      databaseURL: "https://livelinks-cf018-default-rtdb.firebaseio.com",
      projectId: "livelinks-cf018",
      storageBucket: "livelinks-cf018.firebasestorage.app",
      messagingSenderId: "658641708649",
      appId: "1:658641708649:web:620bd1327d75c3678424f8"
    };

    // Initialize Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const database = firebase.database();

    // Generate or retrieve device ID
    const getDeviceId = () => {
      let deviceId = localStorage.getItem('deviceId');
      if (!deviceId) {
        deviceId = 'device-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('deviceId', deviceId);
      }
      return deviceId;
    };

    // Icons
    const Plus = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>);
    const Users = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>);
    const Calendar = () => (<svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>);
    const Trash = () => (<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>);
    const Trophy = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path></svg>);
    const Link = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>);

    function LiveLinks() {
      const [view, setView] = useState('home');
      const [courses, setCourses] = useState([]);
      const [newEvent, setNewEvent] = useState({
        name: '',
        courseId: '',
        date: new Date().toISOString().split('T')[0],
        teams: []
      });
      const [newTeam, setNewTeam] = useState({ name: '', player1: '', player2: '' });
      const [joinCode, setJoinCode] = useState('');
      const [currentEvent, setCurrentEvent] = useState(null);
      const [feedback, setFeedback] = useState('');
      const deviceId = getDeviceId();

      useEffect(() => { loadCourses(); }, []);

      const loadCourses = () => {
        try {
          const coursesData = localStorage.getItem('golf-courses');
          if (coursesData) {
            setCourses(JSON.parse(coursesData));
          } else {
            // Load default courses
            const defaultCourses = [
              { id: 'davis-park', name: "Davis Park", teeColor: "White", holes: [4,3,5,4,4,4,3,5,4,5,3,4,5,3,4,3,4,4] },
              { id: 'valley-view', name: "Valley View", teeColor: "White", holes: [4,5,4,3,4,4,3,4,5,4,5,3,4,4,4,3,5,4] },
              { id: 'wolf-creek', name: "Wolf Creek Golf Club", teeColor: "Masters", holes: [5,4,3,4,5,4,4,3,4,4,3,5,4,4,3,4,5,4] },
              { id: 'sand-hollow', name: "Sand Hollow Golf Course", teeColor: "Signature", holes: [4,5,3,4,4,4,5,3,4,5,3,4,4,4,3,4,5,4] }
            ];
            setCourses(defaultCourses);
            localStorage.setItem('golf-courses', JSON.stringify(defaultCourses));
          }
        } catch (error) {
          console.error('Error loading courses:', error);
        }
      };

      const addTeam = () => {
        if (!newTeam.name || !newTeam.player1 || !newTeam.player2) {
          setFeedback('Please fill in all team fields');
          setTimeout(() => setFeedback(''), 2000);
          return;
        }
        setNewEvent({
          ...newEvent,
          teams: [...newEvent.teams, { ...newTeam, id: Date.now() }]
        });
        setNewTeam({ name: '', player1: '', player2: '' });
      };

      const removeTeam = (teamId) => {
        setNewEvent({
          ...newEvent,
          teams: newEvent.teams.filter(t => t.id !== teamId)
        });
      };

      const createEvent = async () => {
        if (!newEvent.name || !newEvent.courseId || newEvent.teams.length < 2) {
          setFeedback('Please add event name, course, and at least 2 teams');
          setTimeout(() => setFeedback(''), 3000);
          return;
        }

        try {
          const course = courses.find(c => c.id === newEvent.courseId);
          const eventId = 'event-' + Date.now();
          
          const eventData = {
            meta: {
              name: newEvent.name,
              courseId: course.id,
              courseName: course.name,
              coursePars: course.holes,
              format: "2-man-scramble",
              date: newEvent.date,
              createdBy: deviceId,
              status: "active",
              createdAt: Date.now()
            },
            teams: {}
          };

          // Add teams
          newEvent.teams.forEach((team, index) => {
            eventData.teams[`team${index + 1}`] = {
              name: team.name,
              players: [team.player1, team.player2],
              scores: Array(18).fill(null),
              currentHole: 1
            };
          });

          // Write to Firebase
          await database.ref(`events/${eventId}`).set(eventData);
          
          setFeedback(`Event created! Code: ${eventId}`);
          
          // Auto-navigate to event after 2 seconds
          setTimeout(() => {
            setCurrentEvent({ id: eventId, ...eventData });
            setView('event-lobby');
          }, 2000);

        } catch (error) {
          console.error('Error creating event:', error);
          setFeedback('Error creating event. Please try again.');
          setTimeout(() => setFeedback(''), 3000);
        }
      };

      const joinEvent = async () => {
        if (!joinCode.trim()) {
          setFeedback('Please enter an event code');
          setTimeout(() => setFeedback(''), 2000);
          return;
        }

        try {
          const snapshot = await database.ref(`events/${joinCode}`).once('value');
          const eventData = snapshot.val();
          
          if (!eventData) {
            setFeedback('Event not found. Check your code.');
            setTimeout(() => setFeedback(''), 3000);
            return;
          }

          setCurrentEvent({ id: joinCode, ...eventData });
          setView('event-lobby');
          setJoinCode('');
        } catch (error) {
          console.error('Error joining event:', error);
          setFeedback('Error joining event. Please try again.');
          setTimeout(() => setFeedback(''), 3000);
        }
      };

      // HOME VIEW
      if (view === 'home') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-900 via-indigo-800 to-purple-900 p-6 font-sans">
            <div className="max-w-2xl mx-auto">
              <div className="text-center mb-12 pt-8">
                <div className="inline-block bg-white/10 backdrop-blur-sm rounded-full px-6 py-2 mb-4">
                  <span className="text-blue-200 text-sm font-medium tracking-widest uppercase">Golf Events</span>
                </div>
                <h1 className="text-6xl font-bold text-white mb-3" style={{ fontFamily: 'Georgia, serif' }}>LiveLinks</h1>
                <p className="text-blue-200 text-lg">Real-time golf scoring</p>
              </div>

              <div className="space-y-4">
                <button onClick={() => setView('create-event')} className="w-full bg-white/95 backdrop-blur-sm p-6 rounded-2xl shadow-xl hover:bg-white transition-all">
                  <div className="flex items-center gap-4">
                    <div className="bg-blue-600 p-3 rounded-xl"><Trophy /></div>
                    <div className="text-left">
                      <div className="text-xl font-bold text-gray-900">Create Event</div>
                      <div className="text-sm text-gray-600">Host a new golf event</div>
                    </div>
                  </div>
                </button>

                <div className="bg-white/95 backdrop-blur-sm p-6 rounded-2xl shadow-xl">
                  <div className="flex items-center gap-4 mb-4">
                    <div className="bg-indigo-600 p-3 rounded-xl"><Link /></div>
                    <div className="text-left">
                      <div className="text-xl font-bold text-gray-900">Join Event</div>
                      <div className="text-sm text-gray-600">Enter event code</div>
                    </div>
                  </div>
                  <div className="flex gap-3">
                    <input
                      type="text"
                      value={joinCode}
                      onChange={(e) => setJoinCode(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && joinEvent()}
                      placeholder="event-1234567890"
                      className="flex-1 px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-indigo-500 focus:outline-none"
                    />
                    <button
                      onClick={joinEvent}
                      className="bg-indigo-600 text-white px-6 py-3 rounded-xl hover:bg-indigo-700 font-semibold"
                    >
                      Join
                    </button>
                  </div>
                  {feedback && <div className="mt-3 text-sm text-indigo-600">{feedback}</div>}
                </div>
              </div>
            </div>
          </div>
        );
      }

      // CREATE EVENT VIEW
      if (view === 'create-event') {
        const selectedCourse = courses.find(c => c.id === newEvent.courseId);
        
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-900 via-indigo-800 to-purple-900 p-6">
            <div className="max-w-2xl mx-auto">
              <button onClick={() => setView('home')} className="text-white mb-6 hover:text-blue-200">← Back</button>
              <div className="bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-8">
                <h2 className="text-3xl font-bold text-gray-900 mb-6" style={{ fontFamily: 'Georgia, serif' }}>Create Event</h2>
                
                <div className="space-y-6">
                  {/* Event Name */}
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Event Name</label>
                    <input
                      type="text"
                      value={newEvent.name}
                      onChange={(e) => setNewEvent({ ...newEvent, name: e.target.value })}
                      placeholder="March Scramble"
                      className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:outline-none"
                    />
                  </div>

                  {/* Course Selection */}
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Course</label>
                    <select
                      value={newEvent.courseId}
                      onChange={(e) => setNewEvent({ ...newEvent, courseId: e.target.value })}
                      className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:outline-none"
                    >
                      <option value="">Select a course</option>
                      {courses.map(course => (
                        <option key={course.id} value={course.id}>
                          {course.name} - {course.teeColor} Tees
                        </option>
                      ))}
                    </select>
                  </div>

                  {/* Date */}
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Date</label>
                    <input
                      type="date"
                      value={newEvent.date}
                      onChange={(e) => setNewEvent({ ...newEvent, date: e.target.value })}
                      className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:outline-none"
                    />
                  </div>

                  {/* Teams */}
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-3">Teams ({newEvent.teams.length})</label>
                    
                    {/* Existing Teams */}
                    {newEvent.teams.length > 0 && (
                      <div className="space-y-2 mb-4">
                        {newEvent.teams.map(team => (
                          <div key={team.id} className="bg-gray-50 p-4 rounded-xl flex items-center justify-between">
                            <div>
                              <div className="font-semibold text-gray-900">{team.name}</div>
                              <div className="text-sm text-gray-600">{team.player1} & {team.player2}</div>
                            </div>
                            <button onClick={() => removeTeam(team.id)} className="text-red-600 hover:text-red-700 p-2">
                              <Trash />
                            </button>
                          </div>
                        ))}
                      </div>
                    )}

                    {/* Add New Team */}
                    {newEvent.teams.length < 6 && (
                      <div className="bg-blue-50 p-4 rounded-xl space-y-3">
                        <input
                          type="text"
                          value={newTeam.name}
                          onChange={(e) => setNewTeam({ ...newTeam, name: e.target.value })}
                          placeholder="Team name"
                          className="w-full px-4 py-2 rounded-lg border-2 border-blue-200 focus:border-blue-500 focus:outline-none"
                        />
                        <div className="grid grid-cols-2 gap-3">
                          <input
                            type="text"
                            value={newTeam.player1}
                            onChange={(e) => setNewTeam({ ...newTeam, player1: e.target.value })}
                            placeholder="Player 1"
                            className="px-4 py-2 rounded-lg border-2 border-blue-200 focus:border-blue-500 focus:outline-none"
                          />
                          <input
                            type="text"
                            value={newTeam.player2}
                            onChange={(e) => setNewTeam({ ...newTeam, player2: e.target.value })}
                            placeholder="Player 2"
                            className="px-4 py-2 rounded-lg border-2 border-blue-200 focus:border-blue-500 focus:outline-none"
                          />
                        </div>
                        <button
                          onClick={addTeam}
                          className="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 font-semibold"
                        >
                          Add Team
                        </button>
                      </div>
                    )}
                  </div>

                  {feedback && (
                    <div className="bg-blue-50 border-2 border-blue-200 text-blue-800 px-4 py-3 rounded-xl text-sm">
                      {feedback}
                    </div>
                  )}

                  <button
                    onClick={createEvent}
                    className="w-full bg-blue-600 text-white py-4 rounded-xl font-semibold text-lg hover:bg-blue-700 shadow-lg"
                  >
                    Create Event
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // EVENT LOBBY VIEW
      if (view === 'event-lobby' && currentEvent) {
        const teams = Object.entries(currentEvent.teams || {});
        
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-900 via-indigo-800 to-purple-900 p-6">
            <div className="max-w-2xl mx-auto">
              <button onClick={() => { setView('home'); setCurrentEvent(null); }} className="text-white mb-6 hover:text-blue-200">← Leave Event</button>
              
              <div className="bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-8">
                <div className="text-center mb-8">
                  <h2 className="text-3xl font-bold text-gray-900 mb-2">{currentEvent.meta.name}</h2>
                  <p className="text-gray-600 mb-4">{currentEvent.meta.courseName} - {currentEvent.meta.date}</p>
                  <div className="inline-block bg-blue-50 px-4 py-2 rounded-lg">
                    <div className="text-xs text-gray-600 mb-1">Event Code</div>
                    <div className="font-mono font-bold text-blue-600">{currentEvent.id}</div>
                  </div>
                </div>

                <div className="mb-6">
                  <h3 className="text-lg font-semibold text-gray-900 mb-3">Teams</h3>
                  <div className="space-y-3">
                    {teams.map(([teamId, team]) => (
                      <div key={teamId} className="bg-gray-50 p-4 rounded-xl">
                        <div className="font-semibold text-gray-900 mb-1">{team.name}</div>
                        <div className="text-sm text-gray-600">{team.players.join(' & ')}</div>
                      </div>
                    ))}
                  </div>
                </div>

                <div className="bg-yellow-50 border-2 border-yellow-200 p-4 rounded-xl text-center">
                  <div className="text-yellow-800 font-semibold mb-2">Event is Ready!</div>
                  <div className="text-sm text-yellow-700">Scoring interface coming next...</div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      return null;
    }

    ReactDOM.render(<LiveLinks />, document.getElementById('root'));
  </script>
</body>
</html>
